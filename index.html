<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The Presence</title>

<style>
body {
  margin: 0;
  background: black;
  color: white;
  font-family: monospace;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  overflow: hidden;
  transition: background 1s ease;
}

#text {
  text-align: center;
  font-size: 20px;
  padding: 20px;
  max-width: 90%;
  transition: opacity 0.4s ease;
}

.glitch {
  animation: glitch 0.2s infinite;
}

@keyframes glitch {
  0% { transform: translate(1px, -1px); }
  25% { transform: translate(-1px, 1px); }
  50% { transform: translate(1px, 1px); }
  75% { transform: translate(-1px, -1px); }
  100% { transform: translate(0px, 0px); }
}
</style>
</head>

<body>

<div id="text">Initializing...</div>

<script>
let text = document.getElementById("text");

let energy = 0;
let tapTimes = [];
let holdStart = null;
let lastTouch = Date.now();

let visits = parseInt(localStorage.getItem("visits")) || 0;
let totalTouches = parseInt(localStorage.getItem("touches")) || 0;
let phase = parseInt(localStorage.getItem("phase")) || 1;
let streak = parseInt(localStorage.getItem("streak")) || 0;
let lastVisit = localStorage.getItem("lastVisit");

visits++;

let today = new Date().toDateString();
if (lastVisit !== today) {
  streak++;
}
localStorage.setItem("lastVisit", today);
localStorage.setItem("streak", streak);
localStorage.setItem("visits", visits);

function save() {
  localStorage.setItem("touches", totalTouches);
  localStorage.setItem("phase", phase);
}

function show(msg) {
  text.style.opacity = 0;
  setTimeout(() => {
    text.innerText = msg;
    text.style.opacity = 1;
  }, 200);
}

function glitchEffect() {
  text.classList.add("glitch");
  setTimeout(() => text.classList.remove("glitch"), 500);
}

document.addEventListener("touchstart", () => {
  energy += 2;
  totalTouches++;
  tapTimes.push(Date.now());
  holdStart = Date.now();
  lastTouch = Date.now();
  save();
});

document.addEventListener("touchend", () => {
  if (!holdStart) return;
  let holdTime = Date.now() - holdStart;

  if (holdTime > 2000) {
    energy += 5;
    show("Sustained contact detected.");
    glitchEffect();
  }

  holdStart = null;
});

setInterval(() => {
  if (energy > 0) energy--;
}, 2000);

setInterval(() => {

  let idle = Date.now() - lastTouch;

  if (idle > 15000) {
    show("Signal weakening due to inactivity.");
    return;
  }

  if (totalTouches > 30 && phase === 1) {
    phase = 2;
    show("Phase shift initiated.");
    glitchEffect();
  }

  if (totalTouches > 80 && phase === 2) {
    phase = 3;
    show("Containment failing.");
    document.body.style.background = "#111";
    glitchEffect();
  }

  if (totalTouches > 150 && phase === 3) {
    phase = 4;
    show("You were not supposed to reach this state.");
    document.body.style.background = "#200";
    glitchEffect();
  }

  if (Math.random() < 0.03) {
    text.innerText = "▒▒▒▒▒▒▒▒▒▒";
    setTimeout(() => show("Signal distortion detected."), 300);
    glitchEffect();
    return;
  }

  if (energy < 5) {
    show("Low energy. Visits: " + visits);
  } else if (energy < 15) {
    show("Energy rising. Streak: " + streak);
  } else {
    show("Overload threshold nearing.");
  }

}, 3000);

setTimeout(() => {
  show("System active. Visits: " + visits);
}, 1000);

</script>

</body>
</html>
